<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tazo | Livestreamer</title>
  <meta name="description" content="Watch Tazo live on Kick, Twitch, and more." />
  <meta property="og:title" content="Tazo | Livestreamer" />
  <meta property="og:description" content="Streaming IRL and variety content." />
  <meta property="og:url" content="https://tazo.wtf" />
  <meta property="og:image" content="https://tazo.wtf/profile.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="icon" href="/profile.jpg" type="image/jpeg">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-white font-sans">
  <div class="text-center py-10">
    <img src="/profile.jpg" alt="Tazo" class="w-24 h-24 rounded-full mx-auto border-4 border-accent" />
    <h1 class="text-4xl font-bold mt-4">Tazo</h1>
    <p class="text-zinc-400">Livestreamer from Australia</p>
  </div>

  <div id="stream-container" class="w-full max-w-3xl mx-auto px-4 mt-4"></div>
  <div id="twitch-indicator" class="text-center mt-2"></div>

  <div id="link-section" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-xl mx-auto px-4 pb-20"></div>

  <script>
    const kickUsername = "tazo";
    const twitchUsername = "tazo";

    const streamContainer = document.getElementById("stream-container");
    const indicator = document.getElementById("twitch-indicator");

    function embedKick() {
      const iframe = document.createElement("iframe");
      iframe.src = `https://kick.com/embed/${kickUsername}?muted=true&chatEnabled=false`;
      iframe.className = "rounded-xl shadow-md aspect-video w-full";
      iframe.allowFullscreen = true;
      streamContainer.appendChild(iframe);
    }

    function embedTwitch() {
      const iframe = document.createElement("iframe");
      iframe.src = `https://player.twitch.tv/?channel=${twitchUsername}&parent=${location.hostname}&muted=true&chat=false`;
      iframe.className = "rounded-xl shadow-md aspect-video w-full";
      iframe.allowFullscreen = true;
      streamContainer.appendChild(iframe);
    }

    fetch(`https://kick.com/api/v2/channels/${kickUsername}`)
      .then(res => res.json())
      .then(data => {
        if (data.livestream) {
          embedKick();
          checkTwitch("indicator");
        } else {
          checkTwitch("embed");
        }
      })
      .catch(() => checkTwitch("embed"));

    function checkTwitch(mode) {
      fetch(`https://api.ivr.fi/v2/twitch/user/${twitchUsername}`)
        .then(res => res.json())
        .then(data => {
          if (data.stream) {
            if (mode === "embed") {
              embedTwitch();
            } else {
              indicator.innerHTML = `<a href='/twitch' class='text-red-500 font-semibold underline'>ðŸ”´ Also live on Twitch</a>`;
            }
          }
        });
    }

    fetch('/src/links.json')
      .then(res => res.json())
      .then(links => {
        const container = document.getElementById("link-section");
        links.filter(link => link.showOnHomepage).forEach(link => {
          const a = document.createElement("a");
          a.href = `/${link.id}`;
          a.className = "bg-zinc-800 hover:bg-accent text-white py-3 px-5 rounded-xl text-center font-semibold transition flex items-center justify-center gap-2";
          a.innerHTML = `<span>${link.title}</span>`;
          container.appendChild(a);
        });
      });
  </script>
</body>
</html>
